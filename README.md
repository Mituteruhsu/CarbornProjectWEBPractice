<p align="center">
  <img src="assets/banner.svg" alt="CarbonProject Banner" width="100%">
</p>  
# ğŸŒ¿ CarbonProject â€” ESG ç¢³è¶³è·¡ç®¡ç†ç³»çµ±

> ä»¥ ASP.NET Core MVC æ¶æ§‹é–‹ç™¼çš„ ESG ç¢³è¶³è·¡ç®¡ç†å¹³å°ï¼Œå”åŠ©ä¼æ¥­è¿½è¹¤ã€åˆ†æèˆ‡å ±å‘Šç¢³æ’æ”¾æ•¸æ“šï¼Œå¯¦ç¾æ°¸çºŒç™¼å±•èˆ‡ ESG ç›®æ¨™ã€‚

![.NET](https://img.shields.io/badge/.NET-8.0-blue?logo=dotnet)
![C#](https://img.shields.io/badge/Language-C%23-green?logo=csharp)
![SQL Server](https://img.shields.io/badge/Database-SQL%20Server-red?logo=microsoftsqlserver)
![Chart.js](https://img.shields.io/badge/Charts-Chart.js-orange?logo=chartdotjs)
![License](https://img.shields.io/badge/License-Academic-lightgrey)
![Status](https://img.shields.io/badge/Status-Active-brightgreen)

---

## ğŸ§­ å°ˆæ¡ˆè³‡è¨Š (Project Information)
| åˆ†é¡ | èªªæ˜ |
|------|------|
| **å°ˆæ¡ˆåç¨±** | CarbonProject |
| **é–‹ç™¼æ¡†æ¶** | ASP.NET Core MVC |
| **è³‡æ–™åº«** | SQL Server / Azure SQL |
| **ä¸»è¦åŠŸèƒ½** | å¸³æˆ¶ç®¡ç†ã€ç¢³æ’è¿½è¹¤ã€ç›®æ¨™è¨­å®šã€æ´»å‹•ç´€éŒ„ |
| **é–‹ç™¼è€…** | å¾ç§‰ç¾¤ (Allen Hsu) |
| **ç‰ˆæœ¬** | v1.0.0 |

---

## ğŸ“š ç›®éŒ„ (Table of Contents)
- [å°ˆæ¡ˆç°¡ä»‹](#å°ˆæ¡ˆç°¡ä»‹)
- [å°ˆæ¡ˆç›®æ¨™](#å°ˆæ¡ˆç›®æ¨™)
- [ç³»çµ±æ¶æ§‹](#ç³»çµ±æ¶æ§‹)
- [æ ¸å¿ƒæ¨¡çµ„](#æ ¸å¿ƒæ¨¡çµ„)
- [ç³»çµ±å®‰å…¨è¨­è¨ˆ](#ç³»çµ±å®‰å…¨è¨­è¨ˆ)
- [è³‡æ–™åº«è¨­è¨ˆï¼ˆSQL Serverï¼‰](#è³‡æ–™åº«è¨­è¨ˆsql-server)
- [å°ˆæ¡ˆäº®é»](#å°ˆæ¡ˆäº®é»)
- [å¾ŒçºŒç™¼å±•å»ºè­°](#å¾ŒçºŒç™¼å±•å»ºè­°)
- [License](#License)
- [å ±å‘Šèˆ‡æ–‡ä»¶](#å ±å‘Šèˆ‡æ–‡ä»¶)
- [è¯çµ¡è³‡è¨Š](#è¯çµ¡è³‡è¨Š)

---
<a name="å°ˆæ¡ˆç°¡ä»‹"></a>
## ğŸ“– å°ˆæ¡ˆç°¡ä»‹

**CarbonProject** æ˜¯ä¸€æ¬¾é¢å‘ä¼æ¥­çš„ç¢³æ’æ”¾èˆ‡ ESG ç®¡ç†ç³»çµ±ã€‚ç³»çµ±ä»¥å¯æ“´å……çš„å¤šå±¤å¼æ¶æ§‹è¨­è¨ˆï¼ˆController / Service / Repository / Modelï¼‰ï¼Œå¼·èª¿å®‰å…¨æ€§èˆ‡å¯ç¶­è­·æ€§ã€‚  
å®ƒèƒ½å”åŠ©ä¼æ¥­ï¼š  
- ğŸ” **ç›¤æŸ¥ç¢³è¶³è·¡**ï¼šè‡ªå‹•è¨ˆç®—èˆ‡åŒ¯ç¸½ç¢³æ’æ”¾æ•¸æ“š  
- ğŸ“Š **è¦–è¦ºåŒ–åˆ†æ**ï¼šå‘ˆç¾ç¢³æ’æ”¾è¶¨å‹¢èˆ‡ç†±é»  
- ğŸ“‘ **ç”Ÿæˆ ESG å ±å‘Š**ï¼šESG è¡Œå‹•ç®¡ç†èˆ‡å ±è¡¨åŒ¯å‡ºï¼ˆå« PDFï¼‰ã€‚ 
- ğŸ‘¥ **è¿½è¹¤è¡Œå‹•æ–¹æ¡ˆ**ï¼šç›£æ§ ESG é€²åº¦èˆ‡ç›®æ¨™é”æˆç‡  

æœ¬ç³»çµ±ä»¥ **ASP.NET Core MVC 8.0** ç‚ºæ ¸å¿ƒï¼Œæ•´åˆ **SQL Serverã€iTextSharp PDFã€Chart.js** ç­‰æŠ€è¡“ï¼Œ  
ä¸¦ç‰¹åˆ¥å¼·èª¿ **ä½¿ç”¨è€…é«”é©— (UX)** èˆ‡ **è³‡å®‰é˜²è­· (Security)**ã€‚

---
<a name="å°ˆæ¡ˆç›®æ¨™"></a>
## ğŸ§­ å°ˆæ¡ˆç›®æ¨™

- ğŸ§© å»ºç«‹å®Œæ•´çš„ **ç¢³æ’æ”¾èˆ‡ ESG ç®¡ç†è§£æ±ºæ–¹æ¡ˆ**
- ğŸ¯ æä¾›ç°¡æ½”ç›´è§€çš„ **ä½¿ç”¨è€…ä»‹é¢**
- ğŸ›¡ï¸ å¼·åŒ– **ä¼æ¥­è³‡æ–™å®‰å…¨ã€è³‡æ–™ç¨½æ ¸èˆ‡å¯è¿½æº¯çš„æ´»å‹•ç´€éŒ„**
- ğŸŒ± å”åŠ©ä¼æ¥­é”æˆ **ç¢³æ’æ”¾é‡é™ä½ 30%**
- â€ğŸ”§ æ”¯æ´é›²ç«¯éƒ¨ç½²èˆ‡æ“´å±•ï¼ˆIIS / Azureï¼‰

---
<a name="ç³»çµ±æ¶æ§‹"></a>
## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

**æŠ€è¡“å †ç–Šï¼ˆTech Stackï¼‰**
| é¡åˆ¥ | æŠ€è¡“ |
|------|------|
| Framework | ASP.NET Core MVC 8.0 |
| èªè¨€ Language | C# |
| è³‡æ–™åº« Database | SQL Server / Azure SQL |
| ORM | Entity Framework Core |
| PDF Engine | iTextSharp |
| å‰ç«¯ | Razor Views, Bootstrap, Chart.js |
| é©—è­‰æœå‹™ Authentication | Claims-Based + Session + JWT |
| Logging | ActivityLog æ¨¡çµ„ |
| éƒ¨ç½² | IIS / Azure Web App |

**ç³»çµ±æµç¨‹ï¼ˆç°¡è¦ç¤ºæ„ï¼‰**

```mermaid
---
config:
  layout: dagre
  theme: redux-dark
  look: neo
---
flowchart TB
U["ğŸ§‘ ä½¿ç”¨è€…"] -- ç™¼å‡º HTTP è«‹æ±‚ --> B["ğŸ’» ç€è¦½å™¨<br>browser"]
subgraph MVC["ASP.NET Core MVC æ‡‰ç”¨ç¨‹å¼"]
    C["Controller"]
    V["View"]
    M["Model"]        
end
subgraph S["ä¼ºæœå™¨ç«¯"]
    IIS["IIS Web ä¼ºæœå™¨"] -- è«‹æ±‚é€²å…¥ç®¡ç·š --> MW["Middleware<br>ä¸­ä»‹å±¤"]
    MVC
    SV["Services<br>æœå‹™"]
    RP["Repositories<br>å„²å­˜åº«"]
    HP["Helpers<br>è¼”åŠ©é¡åˆ¥"]
end
B -- HTTP Request --> IIS
MW -- è½‰äº¤è‡³ --> C
C -- å‘¼å« Model ç²å–è³‡æ–™ --> M
M -- åŸ·è¡Œå•†æ¥­é‚è¼¯ --> SV
SV -- è³‡æ–™å­˜å– --> RP
RP -- CRUD æ“ä½œ --> DB[("ğŸ’¾ SQL Server è³‡æ–™åº«")]
DB --> RP
RP --> SV
SV --> M
M --> C
C -- å‚³éè³‡æ–™çµ¦ View --> V
V -- å›å‚³æ¸²æŸ“å¾Œ HTML --> B
B -- é¡¯ç¤ºçµæœé é¢ --> U
RP -. è¼”åŠ©æ–¹æ³•ï¼šä¾‹å¤–è™•ç†ã€æ ¼å¼åŒ– .-> HP
SV -. è¼”åŠ©æ–¹æ³•ï¼šé©—è­‰ã€è½‰æ› .-> HP
```
---
<a name="æ ¸å¿ƒæ¨¡çµ„"></a>
## ğŸ’¡ æ ¸å¿ƒæ¨¡çµ„  

| æ¨¡çµ„ | åŠŸèƒ½æè¿° |
|------|-----------|
| æœƒå“¡ç™»å…¥ / è¨»å†Š | æ”¯æ´å…¬å¸èˆ‡æˆå“¡å¸³è™Ÿï¼Œæ¡ Session é©—è­‰ |
| ç¢³æ’æ”¾ç´€éŒ„ | å¯è¨˜éŒ„å¹´åº¦æ’æ”¾é‡èˆ‡ç›®æ¨™å€¼ |
| è¦–è¦ºåŒ–åœ–è¡¨ | ä½¿ç”¨ Chart.js å‘ˆç¾æ’æ”¾è¶¨å‹¢èˆ‡æ¯”ä¾‹ |
| æ´»å‹•ç´€éŒ„ | è¿½è¹¤ç™»å…¥ã€æ›´æ–°èˆ‡è³‡æ–™è®Šæ›´ |
| ç®¡ç†è€…å¾Œå° | æŸ¥çœ‹å…¨å…¬å¸è³‡æ–™èˆ‡å¹³å‡æ’æ”¾ç‹€æ³ |

- **æœƒå“¡èˆ‡æ¬Šé™ç®¡ç†**ï¼ˆAdmin / Company / Staff / Viewerï¼‰  
- **ç¢³æ’æ”¾è¨˜éŒ„èˆ‡ç›®æ¨™**ï¼ˆCompanyEmissionsã€CompanyEmissionTargetsï¼‰  
- **ESG è¡Œå‹•ç®¡ç†**ï¼ˆESGActionsã€ESGProgressï¼‰  
- **æ´»å‹•æ—¥èªŒ**ï¼ˆActivityLogï¼‰ï¼šæ“ä½œç¨½æ ¸ã€IP / User-Agent / CorrelationId  
- **å…¬å‘Šç³»çµ±**ï¼ˆCompany å±¤ç´šï¼‰  
- **å ±è¡¨åŒ¯å‡º**ï¼šPDFï¼ˆiTextSharpï¼‰ã€Chart.js è¦–è¦ºåŒ–  
---
<a name="ç³»çµ±å®‰å…¨è¨­è¨ˆ"></a>
## ğŸ” ç³»çµ±å®‰å…¨è¨­è¨ˆ
- Claims-based èªè­‰ + Session + JWTï¼ˆå¯é¸ã€Œè¨˜ä½æˆ‘ã€åŠŸèƒ½ï¼‰  
- å¯†ç¢¼ä½¿ç”¨ BCrypt åŠ å¯†ï¼ˆBCrypt.Net-Nextï¼‰  
- å¸³è™Ÿé–å®šæ©Ÿåˆ¶ï¼šé€£çºŒå¤±æ•— 5 æ¬¡é–å®šï¼Œ30 åˆ†é˜è‡ªå‹•è§£é–  
- CSRF é˜²è­·ï¼ˆValidateAntiForgeryTokenï¼‰èˆ‡å®‰å…¨ Cookieï¼ˆHttpOnly / Secure / SameSiteï¼‰  
- è§’è‰²/æ¬Šé™è¡¨ï¼ˆRoles_Permissionsï¼‰å¯¦ä½œ RBAC  

---
<a name="è³‡æ–™åº«è¨­è¨ˆ"></a>
## ğŸ“€ è³‡æ–™åº«è¨­è¨ˆï¼ˆSQL Serverï¼‰  
ç°¡åŒ– ER åœ–ï¼ˆä¸»è¦è¡¨æ ¼èˆ‡é—œè¯ï¼‰ï¼š  

```mermaid
---
config:
  layout: dagre
  theme: redux-dark-color
  look: neo
---
erDiagram
    USERS {
        int MemberId PK
        nvarchar Username
        nvarchar Email
        nvarchar PasswordHash
        nvarchar FullName
        int CompanyId FK
        nvarchar Role
        bit IsActive
        datetime CreatedAt
        datetime UpdatedAt
    }
    ROLES_PERMISSIONS {
        nvarchar Role PK
        nvarchar Permission_Key PK
        nvarchar Description
    }
    USERCOMPANYMAP {
        int Id PK
        int MemberId FK
        int CompanyId FK
        nvarchar Role
    }
    COMPANIES {
        int CompanyId PK
        nvarchar CompanyName
        nvarchar TaxId
        nvarchar Industry_Id FK
        nvarchar Contact_Email
        datetime CreatedAt
        datetime UpdatedAt
    }
    INDUSTRIES {
        nvarchar Industry_Id PK
        nvarchar Major_Category_Name
        nvarchar Middle_Category_Name
    }
    ESGACTIONS {
        int Id PK
        nvarchar Title
        nvarchar Category
        decimal ExpectedReductionTon
        decimal ProgressPercent
        int MemberId FK
        int CompanyId FK
    }
    ESGPROGRESS {
        int Id PK
        int Year
        decimal TotalReductionTon
        decimal AverageProgress
    }
    COMPANYEMISSIONS {
        int EmissionId PK
        int CompanyId FK
        int Year
        decimal Scope1Emission
        decimal Scope2Emission
        decimal Scope3Emission
        decimal TotalEmission
    }
    COMPANYEMISSIONTARGETS {
        int TargetId PK
        int CompanyId FK
        int BaselineYear
        int TargetYear
        decimal BaselineEmission
        decimal TargetEmission
    }
    CARBONRECORDS {
        int Id PK
        nvarchar Name
        decimal Usage
        nvarchar Unit
        decimal Factor
        decimal Emission
        datetime CreatedAt
    }
    ACTIVITYLOG {
        bigint LogId PK
        int MemberId FK
        int CompanyId FK
        nvarchar ActionType
        datetime ActionTime
        nvarchar IpAddress
        nvarchar Source
    }
    USERS ||--o{ USERCOMPANYMAP : "maps"
    COMPANIES ||--o{ USERCOMPANYMAP : "has"
    COMPANIES ||--o{ USERS : "employs"
    COMPANIES ||--o{ COMPANYEMISSIONS : "reports"
    COMPANIES ||--o{ COMPANYEMISSIONTARGETS : "targets"
    COMPANIES ||--o{ ESGACTIONS : "initiates"
    COMPANIES ||--o{ ACTIVITYLOG : "logged by"
    USERS ||--o{ ACTIVITYLOG : "performs"
    USERS ||--o{ ESGACTIONS : "creates"
    INDUSTRIES ||--o{ COMPANIES : "categorized as"
    USERS ||--o{ ROLES_PERMISSIONS : "authorized"

```
---
<a name="å°ˆæ¡ˆäº®é»"></a>
## ğŸŒŸ å°ˆæ¡ˆäº®é»

  æœ¬å°ˆæ¡ˆæ¡ç”¨ **ASP.NET Core MVC æ¶æ§‹**èˆ‡**å¤šå±¤å¼è¨­è¨ˆ**åŸå‰‡ï¼Œçµåˆç¾ä»£åŒ–çš„æŠ€è¡“å¯¦è¸ï¼Œæ‰“é€ å‡ºé«˜æ•ˆèƒ½ã€å¯ç¶­è­·ã€å¯æ“´å……çš„ä¼æ¥­ç´šç¢³ç®¡ç†ç³»çµ±ã€‚  
  The project is built with ASP.NET Core MVC architecture and modern design principles, focusing on performance, scalability, and maintainability for enterprise-level carbon management.  
- æ¡ç”¨ å¤šå±¤å¼æ¶æ§‹ï¼ˆController / Service / Repositoryï¼‰æé«˜å¯ç¶­è­·æ€§  
- ä½¿ç”¨ EF Core ç°¡åŒ– ORM èˆ‡ Migration ç®¡ç†  
- ActivityLog æä¾›å®Œæ•´æ“ä½œç¨½æ ¸èˆ‡è¿½è¹¤èƒ½åŠ›  
- æ”¯æ´ PDF åŒ¯å‡ºï¼ˆä¸­æ–‡å­—é«”è™•ç†ï¼‰èˆ‡ Chart.js è¦–è¦ºåŒ–å ±è¡¨  
- è¨­è¨ˆå…¼é¡§å®‰å…¨æ€§ï¼ˆBCryptã€CSRFã€HttpOnly Cookieã€å¸³è™Ÿé–å®šï¼‰  

### ğŸ§© æ¶æ§‹è¨­è¨ˆ Architecture Design

- **ASP.NET Core MVC Framework**  
  æ¡ç”¨è·¨å¹³å°ã€é«˜æ•ˆèƒ½çš„ ASP.NET Coreï¼Œå…·å‚™è‰¯å¥½çš„å¯ç¶­è­·æ€§èˆ‡å¯æ“´å±•æ€§ã€‚  
  Built on ASP.NET Core, a high-performance and cross-platform web framework for scalable and maintainable applications.

- **Layered Architecture (å¤šå±¤å¼æ¶æ§‹)**  
  å°‡æ‡‰ç”¨åˆ†ç‚º Controllerã€Serviceã€Repositoryã€Model ç­‰å±¤ï¼Œç¢ºä¿è·è²¬åˆ†é›¢ã€‚  
  Implements a layered architecture to ensure clear separation of concerns between components.

### ğŸ’¾ è³‡æ–™å­˜å–å±¤ Data Access Layer

- **Entity Framework Core (EF Core)**  
  ä½¿ç”¨ EF Core é€²è¡Œ ORM æ“ä½œï¼Œç°¡åŒ–è³‡æ–™åº« CRUD æµç¨‹ï¼Œä¸¦æ”¯æ´ LINQ æŸ¥è©¢èˆ‡ Migration ç®¡ç†ã€‚  
  Utilizes EF Core for ORM-based data access, simplifying CRUD operations and supporting LINQ and database migrations.

- **Repository Pattern**  
  å°‡è³‡æ–™å­˜å–é‚è¼¯å°è£æ–¼ Repositoryï¼Œå¯¦ç¾è³‡æ–™å±¤èˆ‡æ¥­å‹™é‚è¼¯å±¤åˆ†é›¢ã€‚  
  Encapsulates data access logic within repositories for better abstraction and maintainability.

### ğŸ§  ç³»çµ±è¨­è¨ˆ System Design

- **Dependency Injection (ä¾è³´æ³¨å…¥)**  
  ä½¿ç”¨ ASP.NET Core å…§å»ºçš„ DI å®¹å™¨ï¼Œé™ä½è€¦åˆåº¦ä¸¦æå‡å¯æ¸¬è©¦æ€§ã€‚  
  Employs built-in dependency injection to enhance testability and reduce coupling between components.

- **ViewModel Pattern**  
  å°‡è³‡æ–™ç”± Controller å‚³éè‡³ Viewï¼Œç¢ºä¿è³‡æ–™çµæ§‹èˆ‡é¡¯ç¤ºé‚è¼¯åˆ†é›¢ã€‚  
  Uses ViewModel to transfer data between Controller and View, improving front-end flexibility.

- **Session ç‹€æ…‹ç®¡ç† (Session Management)**  
  é€é Session å„²å­˜ç™»å…¥ä½¿ç”¨è€…è³‡è¨Šï¼ˆå¦‚ MemberId, CompanyIdï¼‰ï¼Œç¶­æŒä½¿ç”¨è€…ç‹€æ…‹ã€‚  
  Manages user sessions to persist authentication and contextual data between requests.

### ğŸ“Š ç³»çµ±ç´€éŒ„èˆ‡è¿½è¹¤ System Logging & Auditing

- **ActivityLog ä½¿ç”¨è€…æ´»å‹•ç´€éŒ„**  
  å°‡ä½¿ç”¨è€…æ“ä½œè¨˜éŒ„æ–¼è³‡æ–™è¡¨ä¸­ï¼ŒåŒ…æ‹¬ç™»å…¥ã€ç™»å‡ºã€ä¿®æ”¹ã€åˆªé™¤ç­‰å‹•ä½œï¼Œæ–¹ä¾¿å¾ŒçºŒç¨½æ ¸èˆ‡è¡Œç‚ºåˆ†æã€‚  
  Records all user actions such as login, logout, and updates into the ActivityLog table for audit and analysis.

- **IP & User-Agent è¿½è¹¤**  
  æ¯ç­†æ´»å‹•ç´€éŒ„åŒ…å« IP ä½å€èˆ‡ä½¿ç”¨è€…ä»£ç†è³‡è¨Šï¼Œä»¥æå‡å®‰å…¨æ€§èˆ‡å¯è¿½æº¯æ€§ã€‚  
  Each activity entry stores IP address and User-Agent for enhanced security and traceability.

### ğŸ” å®‰å…¨æ€§è¨­è¨ˆ Security Features

- **è§’è‰²èˆ‡æ¬Šé™ç®¡ç† (Role-Based Access Control)**  
  ä½¿ç”¨ Roles_Permissions è¡¨å¯¦ä½œè§’è‰²æ¬Šé™æ§åˆ¶ï¼Œç¢ºä¿ä¸åŒèº«åˆ†çš„ä½¿ç”¨è€…åƒ…èƒ½å­˜å–å°æ‡‰åŠŸèƒ½ã€‚  
  Implements RBAC (Role-Based Access Control) using the Roles_Permissions table.

- **å¸³è™Ÿå®‰å…¨æ©Ÿåˆ¶ (Account Protection)**  
  æ”¯æ´é›»å­éƒµä»¶é©—è­‰ã€ç™»å…¥å¤±æ•—æ¬¡æ•¸é™åˆ¶èˆ‡ç‹€æ…‹é–å®šï¼Œä¿éšœç³»çµ±å®‰å…¨ã€‚  
  Supports email confirmation, login attempt limits, and account locking for enhanced security.

### ğŸŒ± æ°¸çºŒç™¼å±•æ¨¡çµ„ Sustainability Modules

- **CompanyEmissions èˆ‡ ESGActions æ¨¡çµ„æ•´åˆ**  
  æ”¯æ´å…¬å¸ç¢³æ’æ”¾ç´€éŒ„ã€ESG è¡Œå‹•è¿½è¹¤èˆ‡æ¸›ç¢³æˆæ•ˆçµ±è¨ˆã€‚  
  Integrates company emission data with ESG actions for emission tracking and sustainability analysis.

- **è‡ªå‹•è¨ˆç®—æ’æ”¾ç¸½é‡ (TotalEmission)**  
  ä½¿ç”¨ SQL è¨ˆç®—æ¬„ä½è‡ªå‹•åŒ¯ç¸½ Scope 1, 2, 3 æ’æ”¾é‡ï¼Œæ¸›å°‘é‡è¤‡è¨ˆç®—ã€‚  
  Uses computed SQL columns to automatically aggregate Scope 1â€“3 emission data.

### ğŸ§° æŠ€è¡“ç¸½è¦½ Tech Stack  
| åˆ†é¡ | æŠ€è¡“ |
|------|-----------|
| å‰ç«¯ (Frontend) | Razor Views, HTML5, Bootstrap |
| å¾Œç«¯ (Backend) | ASP.NET Core MVC, C# |
| ORM | Entity Framework Core |
| è³‡æ–™åº« (Database) | Microsoft Azure SQL Server |
| ç´€éŒ„èˆ‡ç¨½æ ¸ | ActivityLog Table, Middleware Logging |
| æ¶æ§‹è¨­è¨ˆ | Repository Pattern, ViewModel, DI |
| å®‰å…¨æ€§ | Session, Role-Based Access, Validation |

---
<a name="å¾ŒçºŒç™¼å±•å»ºè­°"></a>
## âŒ¨ï¸ å¾ŒçºŒç™¼å±•å»ºè­°  
- **åŠ å…¥èº«ä»½é©—è­‰å’Œæˆæ¬Šï¼š**  
  ç›®å‰å°ˆæ¡ˆæ²’æœ‰å¯¦ç¾å®Œæ•´çš„èº«ä»½é©—è­‰å’Œæˆæ¬ŠåŠŸèƒ½ï¼Œå»ºè­°ä½¿ç”¨ ASP.NET Core Identity ä¾†å¯¦ç¾æ›´å®‰å…¨çš„èº«ä»½é©—è­‰å’Œæˆæ¬Šã€‚  
- **ä½¿ç”¨æ›´ç¾ä»£åŒ–çš„å‰ç«¯æ¡†æ¶ï¼š**  
  ç›®å‰å°ˆæ¡ˆå¯èƒ½ä½¿ç”¨ jQuery æˆ– Bootstrap ç­‰å‰ç«¯æ¡†æ¶ï¼Œå»ºè­°ä½¿ç”¨æ›´ç¾ä»£åŒ–çš„å‰ç«¯æ¡†æ¶ï¼Œä¾‹å¦‚ Reactã€Vue.js æˆ– Angularï¼Œä¾†æé«˜ä½¿ç”¨è€…é«”é©—ã€‚  
- **ä½¿ç”¨æ›´å¼·å¤§çš„æ—¥èªŒæ¡†æ¶ï¼š**  
  ç›®å‰å°ˆæ¡ˆå¯èƒ½ä½¿ç”¨ ILogger ä»‹é¢ä¾†è¨˜éŒ„æ—¥èªŒï¼Œå»ºè­°ä½¿ç”¨æ›´å¼·å¤§çš„æ—¥èªŒæ¡†æ¶ï¼Œä¾‹å¦‚ Serilog æˆ– NLogï¼Œä¾†æä¾›æ›´è±å¯Œçš„æ—¥èªŒåŠŸèƒ½ã€‚  
- **åŠ å…¥å–®å…ƒæ¸¬è©¦å’Œæ•´åˆæ¸¬è©¦ï¼š**  
  ç›®å‰å°ˆæ¡ˆæ²’æœ‰æä¾›æ¸¬è©¦ç¨‹å¼ç¢¼ï¼Œå»ºè­°åŠ å…¥å–®å…ƒæ¸¬è©¦å’Œæ•´åˆæ¸¬è©¦ï¼Œä»¥ç¢ºä¿ç¨‹å¼ç¢¼çš„å“è³ªå’Œç©©å®šæ€§ã€‚  
- **ä½¿ç”¨æ›´å®‰å…¨çš„ Session ç®¡ç†ï¼š**  
  ç›®å‰å°ˆæ¡ˆä½¿ç”¨ Session ä¾†ç®¡ç†ä½¿ç”¨è€…ç‹€æ…‹ï¼Œå»ºè­°ä½¿ç”¨æ›´å®‰å…¨çš„ Session ç®¡ç†æ–¹å¼ï¼Œä¾‹å¦‚ä½¿ç”¨ Redis æˆ– SQL Server ä¾†å„²å­˜ Session è³‡æ–™ã€‚  
- **å„ªåŒ–è³‡æ–™åº«æ•ˆèƒ½ï¼š**  
  å»ºè­°å°è³‡æ–™åº«é€²è¡Œæ•ˆèƒ½å„ªåŒ–ï¼Œä¾‹å¦‚å»ºç«‹ç´¢å¼•ã€å„ªåŒ–æŸ¥è©¢èªå¥ç­‰ï¼Œä»¥æé«˜æ‡‰ç”¨ç¨‹å¼çš„æ•ˆèƒ½ã€‚

---

<a name="License"></a>
## ğŸ“„ æˆæ¬Šæ¢æ¬¾ (License)

æ­¤å°ˆæ¡ˆåƒ…ä¾›å­¸è¡“èˆ‡å…§éƒ¨é–‹ç™¼æ¸¬è©¦ç”¨é€”ï¼Œæœªç¶“æˆæ¬Šè«‹å‹¿ç”¨æ–¼å•†æ¥­ç›®çš„ã€‚

Copyright (c) 2025 Allen Hsu

Permission is hereby granted to use, copy, and modify this software 
for **academic, research, or educational purposes only**, provided 
that proper credit is given to the original author.

Commercial use, redistribution, or modification for profit is 
strictly prohibited without explicit written permission.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND.

---

<a name="å ±å‘Šèˆ‡æ–‡ä»¶"></a>
## ğŸ“ å ±å‘Šèˆ‡æ–‡ä»¶  
è©³ç´°åŠŸèƒ½èªªæ˜ã€è³‡æ–™åº«è…³æœ¬èˆ‡é•·ç¯‡å ±å‘Šæ”¾åœ¨  
docs/  
Report/  
database/  

---

<a name="è¯çµ¡è³‡è¨Š"></a>
## âœ‰ï¸ è¯çµ¡è³‡è¨Š

é–‹ç™¼è€…ï¼šå¾ç§‰ç¾¤ (Allen Hsu)
Emailï¼šmituteruhsu@gmail.com

---

# CarbonProject ç¢³è¶³è·¡ç®¡ç†ç³»çµ± - åŠŸèƒ½èªªæ˜å ±å‘Š
  å°ˆæ¡ˆæ–‡æª”è³‡æ–™ / CarbonProjectåŠŸèƒ½èªªæ˜å ±å‘Š.txt  
  å»ºç«‹æ—¥æœŸï¼š2025-10-29
# 

---

#ã€å°ˆæ¡ˆæ¦‚è¿°ã€‘
â€¢ å°ˆæ¡ˆåç¨±ï¼šCarbonProject ç¢³è¶³è·¡ç®¡ç†ç³»çµ±
â€¢ é–‹ç™¼æ¡†æ¶ï¼šASP.NET Core MVC 8.0
â€¢ è³‡æ–™åº«ï¼šSQL Server (Azure SQL Database)
â€¢ æŠ€è¡“æ¶æ§‹ï¼šClaims-based èªè­‰ + Session + JWT ä¸‰é‡æ”¯æŒ

## ç¬¬ä¸€ç« ï¼šè§’è‰²æ¬Šé™ç³»çµ±
ã€è§’è‰²å®šç¾©ã€‘
ç³»çµ±æä¾›å››ç¨®ä½¿ç”¨è€…è§’è‰²ï¼Œæ¯ç¨®è§’è‰²æ“æœ‰ä¸åŒçš„åŠŸèƒ½æ¬Šé™ï¼š

â€¢ Adminï¼ˆç®¡ç†å“¡ï¼‰
  - å¯è¨ªå•æ‰€æœ‰åŠŸèƒ½
  - ç®¡ç†å“¡é‡‘é‘°ï¼šQE2U-4HIY-WXZ5-679P
  - æ“æœ‰æœƒå“¡ç®¡ç†æ¬Šé™ï¼Œå¯ç·¨è¼¯ã€åˆªé™¤æ‰€æœ‰æœƒå“¡è³‡æ–™
  - å¯è¨ªå•æ´»å‹•æ—¥èªŒç³»çµ±

â€¢ Companyï¼ˆä¼æ¥­ï¼‰
  - å¯è¨ªå•ä¼æ¥­å„€éŒ¶æ¿
  - ç®¡ç†è‡ªå·±å…¬å¸çš„å“¡å·¥ï¼ˆCompany å’Œ Staff è§’è‰²ï¼‰
  - å¯ç·¨è¼¯ã€åˆªé™¤å…¬å¸å“¡å·¥è³‡æ–™
  - å¯æŸ¥çœ‹ ESG è¡Œå‹•èˆ‡é€²åº¦
  - å¯ç™¼å¸ƒå…¬å‘Šçµ¦å…¬å¸å“¡å·¥

â€¢ Staffï¼ˆä¼æ¥­å“¡å·¥ï¼‰
  - è¨»å†Šæ™‚éœ€é¸æ“‡ä¼æ¥­ä¸¦è‡ªå‹•ç¶å®š
  - å¯è¨ªå•ç³»çµ±åŸºæœ¬åŠŸèƒ½
  - å¯æŸ¥çœ‹å…¬å¸å…¬å‘Š
  - å¯åƒèˆ‡ ESG è¡Œå‹•æ–¹æ¡ˆ

â€¢ Viewerï¼ˆä¸€èˆ¬ä½¿ç”¨è€…ï¼‰
  - å¯è¨ªå•ç³»çµ±åŸºæœ¬åŠŸèƒ½
  - åªèƒ½æŸ¥çœ‹å…¬é–‹è³‡è¨Š

ã€æ ¸å¿ƒç¨‹å¼ç¢¼ä½ç½®ã€‘
ä½ç½®ï¼šControllers/Account.cs:107-126
æ–¹æ³•ï¼šLogin() - Claims èº«ä»½èªè­‰è¨­å®š
åŠŸèƒ½ï¼šå»ºç«‹ Claims Principalï¼ˆç”¨æˆ¶IDã€ç”¨æˆ¶åã€è§’è‰²ã€ä¿¡ç®±ï¼‰

ä½ç½®ï¼šControllers/Account.cs:451-478
æ–¹æ³•ï¼šAdmin_read() - ç®¡ç†å“¡æœƒå“¡ç®¡ç†
åŠŸèƒ½ï¼šæª¢æŸ¥ Admin è§’è‰²æ¬Šé™ï¼Œé¡¯ç¤ºæ‰€æœ‰æœƒå“¡åˆ—è¡¨

ä½ç½®ï¼šControllers/Account.cs:482-518
æ–¹æ³•ï¼šCompanyDashboard() - ä¼æ¥­å„€éŒ¶æ¿
åŠŸèƒ½ï¼šæª¢æŸ¥ Company è§’è‰²ï¼Œé¡¯ç¤ºå…¬å¸å“¡å·¥åˆ—è¡¨

## ç¬¬äºŒç« ï¼šä½¿ç”¨è€…èªè­‰èˆ‡è¨»å†Šç³»çµ±
ã€ç™»å…¥åŠŸèƒ½ã€‘
â€¢ æ”¯æ´ä¸‰ç¨®èªè­‰æ©Ÿåˆ¶ï¼šClaims-basedã€Sessionã€JWTï¼ˆè¨˜ä½æˆ‘åŠŸèƒ½ï¼‰
â€¢ å¸³è™Ÿé–å®šæ©Ÿåˆ¶ï¼š5 æ¬¡å¤±æ•—å¾Œé–å®šï¼Œ30 åˆ†é˜å¾Œè‡ªå‹•è§£é–
â€¢ ç™»å…¥é©—è­‰ï¼šå¸³è™Ÿè‡³å°‘4ä½æ•¸ï¼Œå¯†ç¢¼è‡³å°‘8ä½æ•¸
â€¢ å®‰å…¨æ€§ï¼šCSRF ä¿è­·ã€å¯†ç¢¼åŠ å¯†ï¼ˆBCryptï¼‰

æ ¸å¿ƒæ–¹æ³•ï¼š
ä½ç½®ï¼šControllers/Account.cs:48-170
æ–¹æ³•ï¼šLogin(string UID, string password, bool RememberMe)
åŠŸèƒ½ï¼šç™»å…¥é©—è­‰ã€Session è¨­å®šã€JWT Token ç”Ÿæˆã€æ´»å‹•æ—¥èªŒè¨˜éŒ„

ä½ç½®ï¼šModels/Members.cs
æ–¹æ³•ï¼šCheckLogin() - ç™»å…¥é©—è­‰
æ–¹æ³•ï¼šIncrementFailedLogin() - è¨˜éŒ„å¤±æ•—æ¬¡æ•¸
æ–¹æ³•ï¼šUpdateLastLoginAt() - æ›´æ–°æœ€å¾Œç™»å…¥æ™‚é–“

ã€è¨»å†ŠåŠŸèƒ½ã€‘
â€¢ æ”¯æ´å››ç¨®è§’è‰²è¨»å†Šï¼ˆéœ€ç®¡ç†å“¡é‡‘é‘°é©—è­‰ Admin è§’è‰²ï¼‰
â€¢ ä¼æ¥­è¨»å†Šï¼šè‡ªå‹•å»ºç«‹æˆ–ç¶å®šç¾æœ‰ä¼æ¥­
â€¢ ä¼æ¥­å“¡å·¥è¨»å†Šï¼šéœ€è¼¸å…¥å·²å­˜åœ¨çš„ä¼æ¥­åç¨±ï¼Œè‡ªå‹•ç¶å®šå…¬å¸
â€¢ è¼¸å…¥é©—è­‰ï¼šæ­£å‰‡è¡¨é”å¼é©—è­‰å¸³è™Ÿã€ä¿¡ç®±ã€å¯†ç¢¼æ ¼å¼

æ ¸å¿ƒæ–¹æ³•ï¼š
ä½ç½®ï¼šControllers/Account.cs:216-402
æ–¹æ³•ï¼šRegister() - æœƒå“¡è¨»å†Šè™•ç†
åŠŸèƒ½ï¼šé©—è­‰ç®¡ç†å“¡é‡‘é‘°ã€ä¼æ¥­ç¶å®šã€ç”¢æ¥­é¸æ“‡ã€é©—è­‰é‡è¤‡å¸³è™Ÿ

ä½ç½®ï¼šControllers/Account.cs:405-448
æ–¹æ³•ï¼šGetIndustries() - å–å¾—ç”¢æ¥­åˆ†é¡
æ–¹æ³•ï¼šGetCompanyByTaxId() - ä¾çµ±ç·¨æŸ¥è©¢ä¼æ¥­
æ–¹æ³•ï¼šCheckCompany() - æª¢æŸ¥ä¼æ¥­æ˜¯å¦å­˜åœ¨

## ç¬¬ä¸‰ç« ï¼šé¦–é èˆ‡ç™»å…¥è¶¨å‹¢åˆ†æ

ã€é¦–é åŠŸèƒ½ã€‘
â€¢ é¡¯ç¤º 7/15/30 æ—¥ç™»å…¥è¶¨å‹¢åœ–ï¼ˆæ”¯æ´å³æ™‚åˆ‡æ›ï¼‰
â€¢ ä½¿ç”¨ Chart.js ç¹ªè£½æŠ˜ç·šåœ–
â€¢ æ”¯æ´ AJAX å°èˆªç³»çµ±ï¼ˆç„¡åˆ·æ–°é é¢åˆ‡æ›ï¼‰
â€¢ é¦–é é—œé–‰é é¢å¿«å–ï¼Œç¢ºä¿è³‡æ–™å³æ™‚æ€§

æ ¸å¿ƒæ–¹æ³•ï¼š
ä½ç½®ï¼šControllers/HomeController.cs:22-26
æ–¹æ³•ï¼šIndex() - é¦–é é¡¯ç¤º
åŠŸèƒ½ï¼šå–å¾—é¦–é çµ±è¨ˆæ•¸æ“š

ä½ç½®ï¼šControllers/HomeController.cs:36-88
æ–¹æ³•ï¼šLoginTrend(int days) - ç™»å…¥è¶¨å‹¢ API
åŠŸèƒ½ï¼šæŸ¥è©¢ ActivityLog è³‡æ–™è¡¨ï¼Œèšåˆç™»å…¥æˆåŠŸçµ±è¨ˆ
åƒæ•¸ï¼š7/15/30 æ—¥ï¼ˆåƒ…å…è¨±é€™ä¸‰å€‹å€¼ï¼‰

ä½ç½®ï¼šwwwroot/js/site.js
æ–¹æ³•ï¼šinitHomePageChart() - åœ–è¡¨åˆå§‹åŒ–
åŠŸèƒ½ï¼šChart.js åœ–è¡¨ç¹ªè£½ï¼Œæ”¯æ´åˆ‡æ›æ—¥æœŸç¯„åœæŒ‰éˆ•

## ç¬¬å››ç« ï¼šæœƒå“¡ç®¡ç†ç³»çµ±ï¼ˆAdmin å°ˆç”¨)

ã€åŠŸèƒ½èªªæ˜ã€‘
â€¢ æŸ¥çœ‹æ‰€æœ‰æœƒå“¡åˆ—è¡¨
â€¢ ç·¨è¼¯æœƒå“¡è³‡æ–™ï¼ˆå¸³è™Ÿã€ä¿¡ç®±ã€å§“åï¼‰
â€¢ åˆªé™¤æœƒå“¡
â€¢ æœå°‹æœƒå“¡ï¼ˆæ”¯æ´å³æ™‚æœå°‹ï¼‰

æ ¸å¿ƒæ–¹æ³•ï¼š
ä½ç½®ï¼šControllers/Account.cs:450-478
æ–¹æ³•ï¼šAdmin_read() - æœƒå“¡ç®¡ç†é é¢
åŠŸèƒ½ï¼šé¡¯ç¤ºæ‰€æœ‰æœƒå“¡åˆ—è¡¨

ä½ç½®ï¼šControllers/Account.cs:521-544
æ–¹æ³•ï¼šDeleteMember(int id) - åˆªé™¤æœƒå“¡ï¼ˆAdmin å°ˆç”¨ï¼‰
åŠŸèƒ½ï¼šæ¬Šé™æª¢æŸ¥ã€åˆªé™¤æœƒå“¡ã€è¨˜éŒ„çµæœ

ä½ç½®ï¼šControllers/Account.cs:596-617
æ–¹æ³•ï¼šEditMember() - ç·¨è¼¯æœƒå“¡ï¼ˆAdmin å°ˆç”¨ï¼‰
åŠŸèƒ½ï¼šæ›´æ–°æœƒå“¡è³‡æ–™ï¼ˆå¸³è™Ÿã€ä¿¡ç®±ã€å§“åï¼‰

ä½ç½®ï¼šControllers/Account.cs:671-685
æ–¹æ³•ï¼šSearchMembers() - æœå°‹æœƒå“¡ API
åŠŸèƒ½ï¼šä¾é—œéµå­—æœå°‹æœƒå“¡ï¼ˆå³æ™‚æœå°‹ï¼‰

## ç¬¬äº”ç« ï¼šä¼æ¥­å„€è¡¨æ¿ï¼ˆCompany å°ˆç”¨ï¼‰

ã€åŠŸèƒ½èªªæ˜ã€‘
â€¢ ç®¡ç†å…¬å¸å“¡å·¥ï¼ˆCompany å’Œ Staff è§’è‰²ï¼‰
â€¢ ç·¨è¼¯å“¡å·¥è³‡æ–™ï¼ˆåªèƒ½ç·¨è¼¯åŒä¸€å…¬å¸çš„å“¡å·¥ï¼‰
â€¢ åˆªé™¤å“¡å·¥ï¼ˆåªèƒ½åˆªé™¤åŒä¸€å…¬å¸çš„å“¡å·¥ï¼‰
â€¢ æœå°‹å…¬å¸å“¡å·¥

æ ¸å¿ƒæ–¹æ³•ï¼š
ä½ç½®ï¼šControllers/Account.cs:482-518
æ–¹æ³•ï¼šCompanyDashboard() - ä¼æ¥­å„€è¡¨æ¿
åŠŸèƒ½ï¼šå–å¾—å…¬å¸ IDï¼Œé¡¯ç¤ºå…¬å¸æ‰€æœ‰å“¡å·¥åˆ—è¡¨

ä½ç½®ï¼šControllers/Account.cs:547-594
æ–¹æ³•ï¼šDeleteCompanyMember(int id) - åˆªé™¤å…¬å¸å“¡å·¥ï¼ˆCompany å°ˆç”¨ï¼‰
åŠŸèƒ½ï¼šå…¬å¸æ­¸å±¬æª¢æŸ¥ã€åˆªé™¤å“¡å·¥ã€è¨˜éŒ„çµæœ

ä½ç½®ï¼šControllers/Account.cs:622-667
æ–¹æ³•ï¼šEditCompanyMember() - ç·¨è¼¯å…¬å¸å“¡å·¥ï¼ˆCompany å°ˆç”¨ï¼‰
åŠŸèƒ½ï¼šå…¬å¸æ­¸å±¬æª¢æŸ¥ã€æ›´æ–°å“¡å·¥è³‡æ–™

ä½ç½®ï¼šControllers/Account.cs:714-747
æ–¹æ³•ï¼šUpdateCompanyMemberFromSearch() - æœå°‹çµæœæ›´æ–°
æ–¹æ³•ï¼šDeleteCompanyMemberFromSearch() - æœå°‹çµæœåˆªé™¤
åŠŸèƒ½ï¼šè™•ç†æœå°‹çµæœä¸­çš„å“¡å·¥ç·¨è¼¯/åˆªé™¤

## ç¬¬å…­ç« ï¼šå€‹äººè³‡æ–™ç®¡ç†

ã€åŠŸèƒ½èªªæ˜ã€‘
â€¢ æŸ¥çœ‹å€‹äººå®Œæ•´è³‡æ–™
â€¢ ç·¨è¼¯å€‹äººè³‡æ–™ï¼ˆå¸³è™Ÿã€ä¿¡ç®±ã€å§“åï¼‰
â€¢ ä¿®æ”¹å¯†ç¢¼ï¼ˆéœ€é©—è­‰èˆŠå¯†ç¢¼ï¼‰
â€¢ æ–°å¯†ç¢¼ä¸èƒ½èˆ‡èˆŠå¯†ç¢¼ç›¸åŒ
â€¢ è¼¸å…¥é©—è­‰ï¼ˆå¸³è™Ÿè‡³å°‘4ä½ï¼Œå¯†ç¢¼è‡³å°‘8ä½ï¼‰

æ ¸å¿ƒæ–¹æ³•ï¼š
ä½ç½®ï¼šControllers/Account.cs:800-833
æ–¹æ³•ï¼šProfile() - å€‹äººè³‡æ–™é é¢
åŠŸèƒ½ï¼šæª¢æŸ¥ç™»å…¥ç‹€æ…‹ï¼Œé¡¯ç¤ºå€‹äººè©³ç´°è³‡è¨Š

ä½ç½®ï¼šControllers/Account.cs:836-884
æ–¹æ³•ï¼šUpdateProfile() - æ›´æ–°å€‹äººè³‡æ–™
åŠŸèƒ½ï¼šæ¬Šé™é©—è­‰ã€è¼¸å…¥é©—è­‰ã€æ›´æ–°è³‡æ–™ã€æ›´æ–° Session

ä½ç½®ï¼šControllers/Account.cs:888-932
æ–¹æ³•ï¼šChangePassword() - ä¿®æ”¹å¯†ç¢¼
åŠŸèƒ½ï¼šé©—è­‰èˆŠå¯†ç¢¼ã€æª¢æŸ¥æ–°å¯†ç¢¼èˆ‡èˆŠå¯†ç¢¼ä¸åŒã€æ›´æ–°å¯†ç¢¼

ä½ç½®ï¼šModels/Members.cs
æ–¹æ³•ï¼šGetMemberById() - ç²å–ç”¨æˆ¶è©³ç´°è³‡è¨Š
æ–¹æ³•ï¼šUpdateProfile() - æ›´æ–°å€‹äººè³‡æ–™
æ–¹æ³•ï¼šChangePassword() - ä¿®æ”¹å¯†ç¢¼
æ–¹æ³•ï¼šVerifyPassword() - é©—è­‰å¯†ç¢¼æ˜¯å¦ç›¸åŒ

## ç¬¬ä¸ƒç« ï¼šESG è¡Œå‹•æ–¹æ¡ˆç®¡ç†ç³»çµ±

ã€åŠŸèƒ½èªªæ˜ã€‘
â€¢ è¡Œå‹•æ–¹æ¡ˆ CRUDï¼ˆæ–°å¢ã€ç·¨è¼¯ã€åˆªé™¤ã€æŸ¥çœ‹è©³ç´°ï¼‰
â€¢ å¹´åº¦èˆ‡é¡åˆ¥ç¯©é¸ï¼ˆæ”¯æ´æ‰€æœ‰å¹´åº¦ã€å„å¹´åº¦ã€å„é¡åˆ¥ï¼‰
â€¢ é è¨­é¡¯ç¤ºæœ€æ–°å¹´åº¦
â€¢ PDF å ±å‘Šä¸‹è¼‰åŠŸèƒ½ï¼ˆiTextSharpï¼‰

æ ¸å¿ƒæ–¹æ³•ï¼š
ä½ç½®ï¼šControllers/Actions.cs:20-48
æ–¹æ³•ï¼šIndex(int year, string category) - è¡Œå‹•æ–¹æ¡ˆåˆ—è¡¨
åŠŸèƒ½ï¼šå¹´åº¦èˆ‡é¡åˆ¥ç¯©é¸ï¼Œé è¨­é¡¯ç¤ºæœ€æ–°å¹´åº¦

ä½ç½®ï¼šControllers/Actions.cs:50-56
æ–¹æ³•ï¼šDetails(int id) - æŸ¥çœ‹è©³ç´°
åŠŸèƒ½ï¼šé¡¯ç¤ºå–®ä¸€è¡Œå‹•æ–¹æ¡ˆçš„å®Œæ•´è³‡è¨Š

ä½ç½®ï¼šControllers/Actions.cs:59-91
æ–¹æ³•ï¼šCreate() / Create([FromForm] ESGAction) - æ–°å¢è¡Œå‹•
åŠŸèƒ½ï¼šå‰ç«¯é©—è­‰ã€å»é™¤å­—ä¸²ç©ºæ ¼ã€å¯«å…¥è³‡æ–™åº«

ä½ç½®ï¼šControllers/Actions.cs:93-115
æ–¹æ³•ï¼šEdit() / Edit([FromForm] ESGAction) - ç·¨è¼¯è¡Œå‹•
åŠŸèƒ½ï¼šè³‡æ–™æ›´æ–°ã€ModelState é©—è­‰

ä½ç½®ï¼šControllers/Actions.cs:117-125
æ–¹æ³•ï¼šDelete(int id) - åˆªé™¤è¡Œå‹•
åŠŸèƒ½ï¼šåˆªé™¤è³‡æ–™ã€è¿”å›çµæœè¨Šæ¯

ä½ç½®ï¼šControllers/Actions.cs:128-214
æ–¹æ³•ï¼šDownloadReport(int year, string category) - PDF ä¸‹è¼‰
åŠŸèƒ½ï¼šç¯©é¸è³‡æ–™ã€å»ºç«‹ PDF æ–‡ä»¶ã€è¨­å®šå­—å‹ï¼ˆæ”¯æ´ä¸­æ–‡å¾®è»Ÿæ­£é»‘é«”ï¼‰ã€è¡¨æ ¼æ ¼å¼ã€æª”æ¡ˆä¸‹è¼‰

## ç¬¬å…«ç« ï¼šç¢³æ’æ”¾ç›®æ¨™ç®¡ç†

ã€åŠŸèƒ½èªªæ˜ã€‘
â€¢ é¡¯ç¤ºå¹´åº¦ç¢³æ’æ”¾æ•¸æ“šï¼ˆ2020-2025ï¼‰
â€¢ é¡¯ç¤ºç›®æ¨™èˆ‡é”æˆç‡
â€¢ PDF å ±å‘Šä¸‹è¼‰åŠŸèƒ½

æ ¸å¿ƒæ–¹æ³•ï¼š
ä½ç½®ï¼šControllers/DataGoals.cs:17-44
æ–¹æ³•ï¼šIndex() - ç¢³æ’æ”¾ç›®æ¨™é é¢
åŠŸèƒ½ï¼šæ¨¡æ“¬å¹´åº¦æ’ç¢³æ•¸æ“šã€ç›®æ¨™è¨­å®šã€é”æˆç‡è¨ˆç®—

ä½ç½®ï¼šControllers/DataGoals.cs:47-104
æ–¹æ³•ï¼šDownloadReport() - PDF ä¸‹è¼‰
åŠŸèƒ½ï¼šå»ºç«‹ PDF æ–‡ä»¶ã€é¡¯ç¤ºå¹´åº¦æ•¸æ“šã€ç›®æ¨™å°æ¯”åˆ†æ

## ç¬¬ä¹ç« ï¼šä¼æ¥­å…¬å‘Šç®¡ç†ç³»çµ±

ã€åŠŸèƒ½èªªæ˜ã€‘
â€¢ åƒ…é™ Company å’Œ Staff è§’è‰²è¨ªå•
â€¢ å…¬å‘Š CRUDï¼ˆæ–°å¢ã€ç·¨è¼¯ã€åˆªé™¤ã€æŸ¥çœ‹ï¼‰
â€¢ å„ªå…ˆç´šè¨­å®šï¼ˆé«˜ã€ä¸­ã€ä½ï¼‰
â€¢ ç½®é ‚åŠŸèƒ½ï¼ˆIsPinnedï¼‰
â€¢ ä¾å…¬å¸ ID ç¯©é¸ï¼ˆåƒ…é¡¯ç¤ºè©²å…¬å¸å…¬å‘Šï¼‰

æ ¸å¿ƒæ–¹æ³•ï¼š
ä½ç½®ï¼šControllers/Announcement.cs:19-63
æ–¹æ³•ï¼šIndex() - å…¬å‘Šåˆ—è¡¨
åŠŸèƒ½ï¼šæª¢æŸ¥æ¬Šé™ï¼ˆCompany/Staffï¼‰ã€å–å¾—å…¬å¸ IDã€é¡¯ç¤ºå…¬å‘Šåˆ—è¡¨

ä½ç½®ï¼šControllers/Announcement.cs:66-115
æ–¹æ³•ï¼šCreateAnnouncement() - å»ºç«‹å…¬å‘Š
åŠŸèƒ½ï¼šæ¬Šé™æª¢æŸ¥ã€è¼¸å…¥é©—è­‰ã€å»ºç«‹å…¬å‘Šã€è¨˜éŒ„å»ºç«‹è€…

ä½ç½®ï¼šControllers/Announcement.cs:118-159
æ–¹æ³•ï¼šUpdateAnnouncement() - æ›´æ–°å…¬å‘Š
åŠŸèƒ½ï¼šæ¬Šé™æª¢æŸ¥ã€è¼¸å…¥é©—è­‰ã€æ›´æ–°å…¬å‘Šå…§å®¹

ä½ç½®ï¼šControllers/Announcement.cs:162-184
æ–¹æ³•ï¼šDeleteAnnouncement() - åˆªé™¤å…¬å‘Š
åŠŸèƒ½ï¼šæ¬Šé™æª¢æŸ¥ã€åˆªé™¤å…¬å‘Š

ä½ç½®ï¼šControllers/Announcement.cs:188-197
æ–¹æ³•ï¼šGetAnnouncement(int announcementId) - å–å¾—å…¬å‘Šè©³æƒ…
åŠŸèƒ½ï¼šå›å‚³å…¬å‘Šè©³ç´°è³‡è¨Šï¼ˆJSON APIï¼‰

## ç¬¬åç« ï¼šæ´»å‹•æ—¥èªŒè¿½è¹¤ç³»çµ±

ã€åŠŸèƒ½èªªæ˜ã€‘
â€¢ è¨˜éŒ„æ‰€æœ‰ä½¿ç”¨è€…æ“ä½œï¼ˆç™»å…¥ã€ç™»å‡ºã€è³‡æ–™æ–°å¢/ä¿®æ”¹/åˆªé™¤ï¼‰
â€¢ æ”¯æ´åˆ†é é¡¯ç¤ºï¼ˆæ¯é  50 ç­†ï¼‰
â€¢ ä¾å‹•ä½œé¡å‹ã€ä½¿ç”¨è€…åç¨±ç¯©é¸
â€¢ è¨˜éŒ„è©³ç´°è³‡è¨Šï¼ˆIPã€User Agentã€åŸ·è¡Œçµæœã€Correlation IDï¼‰
â€¢ åƒ…é™ç™»å…¥ç”¨æˆ¶è¨ªå•ï¼ˆ[Authorize] å±¬æ€§ä¿è­·ï¼‰

æ ¸å¿ƒæ–¹æ³•ï¼š
ä½ç½®ï¼šControllers/ActivityLogController.cs:23-45
æ–¹æ³•ï¼šIndex(int page, int pageSize, string actionType, string userName)
åŠŸèƒ½ï¼šåˆ†é æŸ¥è©¢æ´»å‹•æ—¥èªŒã€ç¯©é¸åŠŸèƒ½ã€çµ±è¨ˆç¸½ç­†æ•¸èˆ‡ç¸½é æ•¸

ä½ç½®ï¼šControllers/ActivityLogController.cs:154-170
æ–¹æ³•ï¼šDetails(int id) - æ´»å‹•è©³ç´°è³‡è¨Š
åŠŸèƒ½ï¼šé¡¯ç¤ºå–®ä¸€æ´»å‹•è¨˜éŒ„çš„å®Œæ•´è³‡è¨Šï¼ˆå« Correlation IDï¼‰

ä½ç½®ï¼šModels/ActivityLog.cs
æ–¹æ³•ï¼šWrite() - è¨˜éŒ„æ´»å‹•
åŠŸèƒ½ï¼šå°‡æ´»å‹•è¨˜éŒ„å¯«å…¥è³‡æ–™åº«ï¼ˆå« IPã€User Agentã€è©³ç´°è³‡è¨Šï¼‰

ä½ç½®ï¼šModels/ActivityLog.cs
æ–¹æ³•ï¼šInit() - åˆå§‹åŒ–é€£ç·š
åŠŸèƒ½ï¼šè¨­å®šè³‡æ–™åº«é€£æ¥å­—ä¸²

## ç¬¬åä¸€ç« ï¼šAJAX å°èˆªç³»çµ±

ã€åŠŸèƒ½èªªæ˜ã€‘
â€¢ ç„¡åˆ·æ–°é é¢åˆ‡æ›ï¼ˆæå‡ä½¿ç”¨è€…é«”é©—ï¼‰
â€¢ è¡¨å–®å’Œæ¬Šé™æ“ä½œå¼·åˆ¶å®Œæ•´é é¢åˆ·æ–°
â€¢ æ”¯æ´ç€è¦½å™¨æ­·å²è¨˜éŒ„ï¼ˆå‰é€²/å¾Œé€€æŒ‰éˆ•ï¼‰
â€¢ è‡ªå‹•å¥—ç”¨é é¢æ¨£å¼èˆ‡æ¨™é¡Œ
â€¢ é¦–é é—œé–‰å¿«å–ï¼Œç¢ºä¿è³‡æ–™å³æ™‚æ€§

æ ¸å¿ƒæ–¹æ³•ï¼š
ä½ç½®ï¼šwwwroot/js/ajax-navigation.js
åŠŸèƒ½ï¼šé é¢åˆ‡æ›ã€è¼‰å…¥å‹•ç•«ã€ç€è¦½å™¨æ­·å²æ”¯æ´ã€æ¨£å¼/æ¨™é¡Œæ›´æ–°

ä½ç½®ï¼šwwwroot/js/site.js
æ–¹æ³•ï¼šstandardPageInit() - æ¨™æº–åˆå§‹åŒ–
åŠŸèƒ½ï¼šæä¾›çµ±ä¸€çš„é é¢åˆå§‹åŒ–å…¥å£é»ï¼Œé¿å…é‡è¤‡ç¶å®šäº‹ä»¶

ç‰¹æ®Šæ¨™è¨˜ï¼š
â€¢ data-ajax-skip="true" - è¡¨å–®å’Œé—œéµæ“ä½œè·³é AJAXï¼Œä½¿ç”¨å®Œæ•´åˆ·æ–°

## ç¬¬åäºŒç« ï¼šJWT è¨˜ä½æˆ‘åŠŸèƒ½

ã€åŠŸèƒ½èªªæ˜ã€‘
â€¢ å‹¾é¸ã€Œè¨˜ä½æˆ‘ã€å¾Œï¼Œ30 å¤©å…§å…ç™»å…¥
â€¢ æœªå‹¾é¸ã€Œè¨˜ä½æˆ‘ã€æ™‚ï¼Œ24 å°æ™‚éæœŸ
â€¢ Token å„²å­˜åœ¨ HttpOnlyã€Secureã€SameSite Cookie
â€¢ è‡ªå‹•é©—è­‰ä¸¦æ¢å¾© Sessionï¼ˆé€é Middlewareï¼‰
â€¢ ç™»å‡ºæ™‚æ¸…é™¤ JWT cookie

æ ¸å¿ƒæ–¹æ³•ï¼š
ä½ç½®ï¼šServices/JwtService.cs
æ–¹æ³•ï¼šGenerateToken() - ç”Ÿæˆ JWT token
æ–¹æ³•ï¼šValidateToken() - é©—è­‰ä¸¦è§£æ JWT token

ä½ç½®ï¼šMiddleware/JwtAuthenticationMiddleware.cs
åŠŸèƒ½ï¼šè‡ªå‹•æª¢æŸ¥ cookie ä¸­çš„ JWT tokenã€é©—è­‰ä¸¦æ¢å¾© Session

ä½ç½®ï¼šControllers/Account.cs:129-143
åŠŸèƒ½ï¼šå‹¾é¸ã€Œè¨˜ä½æˆ‘ã€æ™‚ç”Ÿæˆä¸¦è¨­ç½® JWT cookie

## ç¬¬åä¸‰ç« ï¼šè³‡æ–™åº«çµæ§‹

ã€æ ¸å¿ƒè³‡æ–™è¡¨ã€‘
â€¢ Usersï¼ˆæœƒå“¡è¡¨ï¼‰- 24 å€‹æ¬„ä½
  ä¸»éµï¼šMemberId (int, Identity)
  é‡è¦æ¬„ä½ï¼šRole, CompanyId, PasswordHashï¼ˆBCryptï¼‰, LastLoginAt, LastLogoutAt, LastFailedLoginAt

â€¢ Companiesï¼ˆä¼æ¥­è¡¨ï¼‰
  ä¸»éµï¼šCompanyId (int, Identity)
  é‡è¦æ¬„ä½ï¼šCompanyName, TaxId, Industry

â€¢ ActivityLogï¼ˆæ´»å‹•æ—¥èªŒè¡¨ï¼‰- 14 å€‹æ¬„ä½
  ä¸»éµï¼šId (int, Identity)
  é‡è¦æ¬„ä½ï¼šActionType, ActionTime, Outcome, IpAddress, UserAgent, CorrelationId

â€¢ ESGActionsï¼ˆESG è¡Œå‹•è¡¨ï¼‰
  ä¸»éµï¼šId (int, Identity)
  é‡è¦æ¬„ä½ï¼šTitle, Category, ExpectedReductionTon, ProgressPercent

â€¢ Announcementsï¼ˆå…¬å‘Šè¡¨ï¼‰
  é‡è¦æ¬„ä½ï¼šCompanyId, Title, Content, Priority, IsPinned, CreatorId

ã€å®‰å…¨æ©Ÿåˆ¶ã€‘
â€¢ å¯†ç¢¼åŠ å¯†ï¼šBCrypt.Net-Next
â€¢ å¸³è™Ÿé–å®šï¼š5 æ¬¡å¤±æ•—é–å®šï¼Œ30 åˆ†é˜è‡ªå‹•è§£é–
â€¢ CSRF ä¿è­·ï¼šValidateAntiForgeryToken
â€¢ Cookie å®‰å…¨ï¼šHttpOnlyã€Secureã€SameSite
â€¢ Claims-based èªè­‰ï¼š[Authorize] å±¬æ€§æ”¯æŒ

## ç¬¬åå››ç« ï¼šç³»çµ±å„ªåŒ–èˆ‡å¾ŒçºŒç™¼å±•å»ºè­°

ã€å·²å®Œæˆçš„å„ªåŒ–ã€‘
âœ… AJAX ç„¡åˆ·æ–°é é¢åˆ‡æ›
âœ… ç™»å…¥å®‰å…¨æ©Ÿåˆ¶ï¼ˆå¤±æ•—é™åˆ¶ã€å¸³è™Ÿé–å®šã€è‡ªå‹•è§£é–ï¼‰
âœ… JWT è¨˜ä½æˆ‘åŠŸèƒ½ï¼ˆ30 å¤©å…ç™»å…¥ï¼‰
âœ… æ´»å‹•æ—¥èªŒè¿½è¹¤ç³»çµ±
âœ… Claims-based èªè­‰èˆ‡æˆæ¬Š
âœ… é¦–é ç™»å…¥è¶¨å‹¢åœ–ï¼ˆChart.jsï¼‰
âœ… æ¨™æº–åˆå§‹åŒ–èˆ‡äº‹ä»¶å§”æ´¾ï¼ˆé¿å…é‡è¤‡ç¶å®šï¼‰

ã€åŠŸèƒ½å„ªåŒ–å»ºè­°ã€‘
1. å¤šèªè¨€æ”¯æ´
   - ç›®å‰åƒ…æ”¯æ´ç¹é«”ä¸­æ–‡
   - å»ºè­°æ–°å¢è‹±æ–‡ã€ç°¡é«”ä¸­æ–‡æ”¯æ´
   - å¯¦ä½œä½ç½®ï¼šViews å±¤ã€Model é©—è­‰è¨Šæ¯

2. æª”æ¡ˆä¸Šå‚³åŠŸèƒ½
   - ç›®å‰ç„¡æª”æ¡ˆä¸Šå‚³åŠŸèƒ½
   - å»ºè­°æ–°å¢ï¼šä¼æ¥­ Logoã€å€‹äººé ­åƒã€ESG è¡Œå‹•é™„ä»¶
   - å¯¦ä½œä½ç½®ï¼šModels/Members.cs, Controllers/Account.cs

3. å³æ™‚é€šçŸ¥ç³»çµ±
   - ç›®å‰ç„¡å³æ™‚é€šçŸ¥åŠŸèƒ½
   - å»ºè­°æ–°å¢ï¼šSignalR å³æ™‚é€šçŸ¥ã€éƒµä»¶é€šçŸ¥ã€ç³»çµ±å…¬å‘Šæ¨æ’­
   - å¯¦ä½œä½ç½®ï¼šHubs ç›®éŒ„ã€Services/EmailService.cs

4. è¡Œå‹•è£ç½®é©é…
   - ç›®å‰æœªé‡å°æ‰‹æ©Ÿå„ªåŒ–
   - å»ºè­°æ–°å¢ï¼šéŸ¿æ‡‰å¼è¨­è¨ˆå„ªåŒ–ã€è§¸æ§æ“ä½œæ”¯æ´
   - å¯¦ä½œä½ç½®ï¼šViews/*.cshtmlï¼ˆBootstrap éŸ¿æ‡‰å¼é¡åˆ¥ï¼‰

5. API æ–‡æª”èˆ‡æ¸¬è©¦
   - ç›®å‰ç„¡ API æ–‡æª”
   - å»ºè­°æ–°å¢ï¼šSwagger/OpenAPI æ–‡æª”ã€å–®å…ƒæ¸¬è©¦ã€æ•´åˆæ¸¬è©¦
   - å¯¦ä½œä½ç½®ï¼šProgram.csï¼ˆSwagger é…ç½®ï¼‰ã€Tests/ ç›®éŒ„

6. æ•ˆèƒ½å„ªåŒ–
   - ç›®å‰è³‡æ–™åº«æŸ¥è©¢è¼ƒç‚ºç›´æ¥
   - å»ºè­°æ–°å¢ï¼šè³‡æ–™åº«é€£ç·šæ± å„ªåŒ–ã€Redis å¿«å–ã€æŸ¥è©¢å„ªåŒ–
   - å¯¦ä½œä½ç½®ï¼šModels/*.csï¼ˆæŸ¥è©¢å„ªåŒ–ï¼‰ã€Program.csï¼ˆRedis é…ç½®ï¼‰

7. å ±è¡¨å¢å¼·
   - ç›®å‰æ”¯æ´ PDF å ±è¡¨
   - å»ºè­°æ–°å¢ï¼šExcel åŒ¯å‡ºã€åœ–è¡¨åŒ¯å‡ºã€è‡ªå‹•åŒ–å ±è¡¨æ’ç¨‹
   - å¯¦ä½œä½ç½®ï¼šControllers/Actions.csã€Services/ReportService.cs

8. æ¬Šé™ç´°åŒ–
   - ç›®å‰æ¬Šé™è¼ƒç‚ºç°¡å–®
   - å»ºè­°æ–°å¢ï¼šç´°ç²’åº¦æ¬Šé™æ§åˆ¶ã€è§’è‰²æ¬Šé™ç®¡ç†ä»‹é¢
   - å¯¦ä½œä½ç½®ï¼šControllers/PermissionController.csã€Models/Roles_Permissions.cs

9. è³‡æ–™åˆ†æåŠŸèƒ½
   - ç›®å‰åƒ…æœ‰åŸºæœ¬çµ±è¨ˆ
   - å»ºè­°æ–°å¢ï¼šç¢³æ’æ”¾è¶¨å‹¢é æ¸¬ã€ESG è¡Œå‹•æ•ˆç›Šåˆ†æã€æ™ºæ…§åŒ–å»ºè­°
   - å¯¦ä½œä½ç½®ï¼šControllers/AnalyticsController.csã€Services/AnalyticsService.cs

10. å¤šç§Ÿæˆ¶æ”¯æ´
    - ç›®å‰ä¼æ¥­é–“è³‡æ–™å®Œå…¨éš”é›¢
    - å»ºè­°æ–°å¢ï¼šè·¨ä¼æ¥­è³‡æ–™åˆ†äº«ï¼ˆç¶“æˆæ¬Šï¼‰ã€å¤šåœ‹åˆ†å…¬å¸ç®¡ç†
    - å¯¦ä½œä½ç½®ï¼šMiddleware/MultiTenantMiddleware.cs

ã€æŠ€è¡“å‚µå‹™èˆ‡é¢¨éšªã€‘
âš  ç·¨è­¯ç‹€æ…‹ï¼š0 å€‹éŒ¯èª¤ï¼Œ0 å€‹è­¦å‘Šï¼ˆæˆªè‡³ 2025-10-28ï¼‰
âš  å®‰å…¨æ€§ï¼šå·²å¯¦æ–½ CSRFã€å¸³è™Ÿé–å®šã€å¯†ç¢¼åŠ å¯†ã€HttpOnly Cookie


#
å ±å‘Šçµèª
#

æœ¬å ±å‘Šå·²å®Œæ•´ä»‹ç´¹ CarbonProject ç¢³è¶³è·¡ç®¡ç†ç³»çµ±çš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ã€è§’è‰²æ¬Šé™ã€å„
åŠŸèƒ½æ¨¡çµ„ã€æŠ€è¡“æ¶æ§‹èˆ‡å¾ŒçºŒç™¼å±•å»ºè­°ã€‚

ç³»çµ±å·²å…·å‚™å®Œæ•´çš„æœƒå“¡ç®¡ç†ã€ä¼æ¥­ç®¡ç†ã€ESG è¡Œå‹•æ–¹æ¡ˆã€ç¢³æ’æ”¾ç›®æ¨™ã€å…¬å‘Šç®¡ç†ã€æ´»
å‹•æ—¥èªŒç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸¦æ¡ç”¨ç¾ä»£åŒ–çš„ AJAX ç„¡åˆ·æ–°å°èˆªã€JWT èªè­‰ã€Claims-based 
æˆæ¬Šç­‰æŠ€è¡“ã€‚

å¾ŒçºŒå¯ä¾éœ€æ±‚é€æ­¥å¯¦ä½œå¤šèªè¨€æ”¯æ´ã€æª”æ¡ˆä¸Šå‚³ã€å³æ™‚é€šçŸ¥ã€è¡Œå‹•è£ç½®é©é…ã€API æ–‡æª”ã€
æ•ˆèƒ½å„ªåŒ–ç­‰åŠŸèƒ½ï¼Œä½¿ç³»çµ±æ›´åŠ å®Œå–„ã€‚
