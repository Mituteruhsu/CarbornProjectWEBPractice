@model CarbonProject.Controllers.DashboardController.DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Dashboard/_DashboardLayout.cshtml";
}
<h2 class="text-center">企業碳排放數據與目標</h2>
<h6 class="text-center">
    平均減碳目標比例：@Model.AvgReductionPercent.ToString("F2")% / 平均目標排放量：@Model.AvgTotalEmission.ToString("N0") 噸
</h6>

<div class="row g-4">
    <!-- 年度平均統計卡片 -->
    <div class="col-xl">
        <div class="card shadow-sm border-1 h-100 bg-transparent border-light">
            <div class="card-body">
                <h6 class="card-text fw-bold">企業平均排放統計</h6>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>年份</th>
                            <th>參與公司數量</th>
                            <th>該年總排放量 (Sum)</th>
                            <th>跨年度平均 (Avg of Sum)</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model.YearlyEmissionAverages)
                        {
                            <tr>
                                <td>@item.Year</td>
                                <th>@item.CompanyCount</th>
                                <td>@item.TotalEmissionSum.ToString("N4")</td>
                                <td>@item.AverageAcrossYears.ToString("N4")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- 排放量圖表卡片 -->
    <div class="col-xl">
        <div class="card shadow-sm border-1 h-100 bg-transparent border-light">
            <div class="card-body" style="height:390px;">
                <h6 class="card-text fw-bold">參與企業平均區勢</h6>
                <!-- 隱藏資料給外部 JS 使用 -->
                <div id="yearlyData" style="display:none">
                    @Model.AvgTotalEmission.ToString("N0")
                    @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.YearlyEmissionAverages))
                </div>
                <canvas class="w-100 h-100 pb-4"
                        id="emissionChart"
                        ></canvas>                
            </div>
        </div>
    </div>
</div>

<!-- 平均減碳目標公式 -->
<div class="card my-3 shadow-sm text-center bg-transparent border-light">
    <div class="card-header bg-success text-white">
        平均減碳目標比例計算公式
    </div>
    <div class="card-body">
        <p class="card-text">
            <strong>平均減碳目標比例</strong>（Reduction Percent）是用來衡量企業相較於基準年，
            在目標年度預計減少的碳排放比例。
        </p>

        <p class="card-text fw-bold">
            <math xmlns="http://www.w3.org/1998/Math/MathML" display="block" style="font-family: monospace; font-size: 1.1em;">
                <mrow>
                    <mi>減碳目標比例</mi>
                    <mo>=</mo>
                    <mfrac>
                        <mrow>
                            <mi>基準年排放量</mi>
                            <mo>-</mo>
                            <mi>目標年排放量</mi>
                        </mrow>
                        <mi>基準年排放量</mi>
                    </mfrac>
                    <mo>&#x00D7;</mo>
                    <mn>100</mn>
                    <mo>%</mo>
                </mrow>
            </math>
        </p>
        <p class="card-text">
            ▸ 基準年排放量（BaselineEmission）＝ 10,000 噸<br>
            ▸ 目標年排放量（TargetEmission）＝ 8,000 噸<br>
            ➜ 平均減碳目標比例 ＝ (10,000 − 8,000) ÷ 10,000 × 100% ＝ <strong>20%</strong>
        </p>
    </div>
</div>
